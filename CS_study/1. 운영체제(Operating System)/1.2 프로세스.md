
# 📌 프로세스

<br/>

## ✅ 프로세스와 스레드


### ☑️ 프로세스(process)
: 컴퓨터에서 실행 중인 하나의 프로그램
- 프로그램은 특정 작업을 수행하기 위한 명령어의 집합
- OS는 프로그램을 실행하면서 디스크에 저장된 데이터를 메모리로 로드한다. 
- 프로세스는 OS로부터 독립된 메모리 영역(코드, 데이터, 스택, 힙)을 할당 받는다.
- 다른 프로세스의 메모리 영역에 접근할 수 없다.

![기술 면접 대비 CS 전공 핵심요약집: 1.2.1 프로세스와 스레드](https://thebook.io/img/080367/022.jpg)
출처: [프로세스에 할당된 메모리 영역](https://thebook.io/080367/0010/)


<br/>

### ☑️ 프로세스 메모리 영역 구조(process)
![](https://thebook.io/img/080367/023.jpg)


•  스택(stack)
:  지역 변수, 함수의 매개변수(parameter), 반환되는 주소 값 등이 저장되는 영역
- **LIFO(Last In First Out, 후입선출)** 방식
  - 높은 주소 값 ➡ 낮은 주소 값으로 메모리가 할당
- 영역 크기는 **컴파일** 때 결정
- **동적으로 메모리 할당 가능**
-  스택 오버플로(stack overflow): 스택 영역이 ➡ 힙 영역을 침범하는 경우
  <br/>

•  힙(heap)
:  사용자에 의해 동적 메모리 할당이 일어나는 영역
- **FIFO(First In First Out, 선입선출)** 방식
  - 낮은 주소 값 ➡ 높은 주소 값으로 메모리가 할당
- 영역 크기는 **런타임** 때 결정
- **동적으로 메모리 할당이 가능**
- 힙 오버플로(heap overflow): 힙 영역이 ➡ 스택 영역을 침범하는 경우
  <br/>

•  데이터(data)
:  전역 변수, 정적 변수, 배열, 구조체 등이 저장되는 영역
- 데이터 영역은 2가지로 나뉜다.
  - BSS(Block Stated Symbol)영역: 초기화하지 않은 변수 저장
  - 데이터 영역: 초기화한 변수를 저장
  <br/>

•  코드(code)
:  실행할 코드가 기계어로 컴파일되어 저장되는 영역
- 텍스트(text)  영역이라고도 한다.

  <br/>

### ☑️ 스레드(thread)
: 프로세스에서 실제로 실행되는 흐름의 단위

- 스레드는 프로세스 안에 존재하므로 프로세스의 메모리 공간을 이용하고, 지역 변수를 저장하는 스택 영역을 할당받는다. 
- 그리고 전역 변수를 저장하는 힙 영역은 다른 스레드와 공유한다.
![](https://thebook.io/img/080367/024_1.jpg)
출처: [운영체제에서 프로세스와 스레드의 구조](https://thebook.io/080367/0013/)
  
<br/>

#### ⏩ 레벨 스레드
- **사용자 레벨 스레드(user-level thread)**
: 사용자가 라이브러리를 이용해 생성 및 관리한다. 

- **커널 레벨 스레드(kernel-level thread)**
:  커널이 스레드를 생성 및 관리한다.
<br/>

멀티 스레드 환경에서 사용자 레벨 스레드와 커널 레벨 스레드는 3가지 관계를 맺을 수 있다.

![](https://blog.kakaocdn.net/dn/drgbdw/btrgCFTQOBI/GkFDQK2cfiziNjajiZIbX0/img.png)
출처: [커널 레벨 쓰레드와 유저 레벨 쓰레드](https://kspsd.tistory.com/50)
<br/>

1.  **다대일 모델(many-to-one model)**
	: 사용자 레벨 스레드 n개에 커널 레벨 스레드 1개가 매핑되어 사용자 레벨에서 스레드를 관리하는 방식
- 단점: 하나의 사용자 레벨 스레드에서 시스템 콜을 호출하면 나머지 사용자 레벨 스레드는 커널 레벨에 접근할 수 없으므로  멀티 코어의 병렬성을 이용할 수 없다.
<br/>

2. **일대일 모델(one-to-one model)**
: 사용자 레벨 스레드 1개에 커널 레벨 스레드 1개가 매핑되는 방식
- 장점: 하나의 사용자 레벨 스레드에서 시스템 콜을 호출하면 다른 사용자 레벨 스레드가 모두 실행되지 않는 다대일 모델의 단점을 해결한다.
- 단점: 사용자 레벨 스레드 수만큼 커널 레벨 스레드가 생성되므로 성능 저하가 일어날 수 있다.
<br/>

3.  **다대다 모델(many-to-many model)**
: 사용자 레벨 스레드 n개에 커널 레벨 스레드 m개가 매핑되는 방식
- 이때 커널 레벨 스레드의 수(m)는 사용자 레벨 스레드의 수(n) 이하다. 
- 장점: 다대일 모델과 일대일 모델의 장점을 포함한다.
- 단점: 구현이 어렵다.

<br/><br/>

### ☑️ PCB (Process Control Block, 프로세스 제어 블록)
: OS에서 프로세스를 생성하고 프로세스를 제어하기 위해 **프로세스 정보를 저장한 데이터**
- 프로세스의 현재 상태, 프로세스를 나타내는 고유의 PID(Process ID), 부모 프로세스의 PID, 자식 프로세스의 PID, 다음 실행할 명령어의 주소인 PC(Program Counter,  프로그램 카운터), 프로세스의 우선순위, 메모리 제한 등을 저장

![](https://thebook.io/img/080367/025_3.jpg)
출처: [PCB](https://thebook.io/080367/0016/)

<br/><br/>

<br/>

## ✅ 프로세스의 생성

- 새로운 프로세스는 기존 프로세스에서  `fork()`  함수를 호출해 생성한다. 
- `fork()` 함수는 기존의 프로세스를 그대로 복제하여 새로운 프로세스를 생성하는데, 이때 기존 프로세스는 **부모 프로세스**(parent process), 복제된 새로운 프로세스는 **자식 프로세스**(child process)라고 부른다. 
- 부모 프로세스에서 `fork()`  함수를 호출하면, 부모 프로세스는 자식 프로세스의 PID 값을,  자식 프로세스는 0을 반환한다.

![](https://thebook.io/img/080367/026.jpg)
출처: [프로세스의 생성](https://thebook.io/080367/0017/)

<br/>

#### ⏩ 운영체제(OS)가 프로세스를 종료하는 경우
• 프로세스가 운영체제의 종료 서비스(`exit()`)를 호출해 정상 종료하는 경우
• 프로세스의 실행 시간 또는 특정 이벤트 발생을 기다리는 시간이 제한된 시간을 초과한 경우
• 프로세스가 파일 검색 또는 입출력에 실패하는 경우
• 오류가 발생하거나 메모리 부족 등이 발생하는 경우

부모 프로세스는 자식 프로세스를 종료시키는 경우
• 자식 프로세스가 할당된 자원을 초과해 사용할 때
• 자식 프로세스에 할당된 작업이 없을 때

<br/><br/>

## ✅ 프로세스 상태도

- 모든 프로세스는 CPU에 의해 생성되고 소멸하는 과정을 거친다. 
- 이 과정에서 프로세스는 5가지 상태(`생성(new), 준비(ready), 대기(waiting), 실행(running), 종료(terminated)`)로 존재한다. 

![](https://thebook.io/img/080367/028.jpg)
출처: [프로세스 상태도](https://thebook.io/080367/0021/)
<br/>

•  생성(new)
: 프로세스가 PCB를 가지고 있지만  OS로부터 승인(admit)받기 전
<br/>

•  준비(ready)
: OS로부터 승인받은 후  준비 큐에서 CPU 할당을 기다림
<br/>

•  실행(running)
: 프로세스가 CPU를 할당받아 실행함
<br/>

•  대기(waiting)
: 프로세스가 입출력이나 이벤트 발생을 기다려야 해서 CPU 사용을 멈추고 기다림
<br/>

•  종료(terminated)
: 프로세스 실행을 종료함

<br/>

### ☑️ 프로세스 상태 변화
• **생성 ➡️ 준비**:  생성 상태의 프로세스가 OS로부터 승인을 받아,  준비 상태의 프로세스가 모여 있는 자료구조인 준비 큐(ready queue)에 추가됨

• **준비 ➡️ 실행**:  준비 큐에 있는 프로세스 중 우선순위가 높은 프로세스가 디스패치(dispatch)되어 실행됨

• **실행 ➡️ 준비**:  CPU 독점을 방지하기 위해 타임아웃(timeout)되어 준비 상태로 변경됨

• **실행 ➡️ 대기**:  입출력 또는 이벤트 때문에 대기 상태로 변경됨

• **대기 ➡️ 준비**:  입출력 또는 이벤트가 완료되어 준비 상태로 변경됨

• **실행 ➡️ 종료**: 실행 중인 프로세스가 정상적으로 끝나서 종료 상태로 변경됨
<br/>

* 승인(admit)
:  CPU를 제외한 다른 자원이 준비되어 해당 프로세스가 준비 상태가 될 수 있도록 OS가 허락하는 것을 의미

* 디스패치(dispatch)
:  프로세스에 CPU 자원을 할당해 해당 프로세스가 준비 상태에서 실행 상태가 되는 것을 의미

<br/><br/>

<br/>

## ✅ 멀티 프로세스와 멀티 스레드


### ☑️ 멀티 프로세스

  

<br/>

  

### ☑️ 멀티 스레드



<br/><br/>

<br/>

## ✅ 콘텍스트 스위칭



<br/><br/>

<br/>

## ✅ 프로세스 동기화


### ☑️ 임계 영역

  

<br/>

  

### ☑️ 세마포어



<br/><br/>

<br/>

## ✅ 교착 상태


<br/><br/>

<br/>

## ✅ 스레드 안전



<br/><br/>

<br/>

## ✅ IPC



<br/><br/>

<br/>

## ✅ 좀비 프로세스와  고아 프로세스




<br/><br/>
