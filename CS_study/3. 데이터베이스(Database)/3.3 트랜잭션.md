
# 📌 트랜잭션

<br/>

## 목차
1. [트랜잭션 (transaction)](#-HTTP)
2. [락](#-HTTP)
3. [이상](#-HTTP)
4. [정규화](#-HTTP)

<br/><br/>

## ✅ 트랜잭션 (transaction)
: 데이터베이스의 상태를 바꾸기 위해 수행하는 작업의 단위 또는 일련의 연산
- 데이터베이스의 트랜잭션은 ACID라는 특징이 있는데, 이는 특성의 4가지의 첫 글자를 딴 용어다.

<br/>

### ☑️ 트랜잭션의 특성 ACID
- 원자성(Atomicity) <br/>
: 트랜잭션이 데이터베이스에 완전히 반영되거나 아예 실행되지 않아야 한다.

- 일관성(Consistency) <br/>
: 트랜잭션 수행이 완료된 데이터베이스는 일관성이 있다.

- 독립성(Isolation) <br/>
: 수행 중인 트랜잭션에 다른 트랜잭션이 끼어들 수 없다.

- 영속성(Durability) <br/>
: 완료한 트랜잭션의 결과가 데이터베이스에 영구적으로 반영된다.

<br/>

### ☑️ TCL (Transaction Control Language)
- 트랜잭션은 원자성 때문에 완전히 반영되거나 아예 실행되지 않아야 한다. <br/>
➡︎ 트랜잭션을 제어하기 위해 TCL(Transaction Control Language)이라는 명령어를 사용한다. 

<br/>

#### ⏩ TCL의 종류
- COMMIT
: 트랜잭션이 정상적으로 종료되어 데이터베이스에 변경 사항을 반영하는 명령어

- ROLLBACK
: 트랜잭션이 비정상적으로 종료되어 트랜잭션이 수행한 변경 사항을 취소하고 데이터베이스를 이전 상태로 되돌리는 명령어

- SAVEPOINT
: 트랜잭션에서 특정 지점을 지정하는 명령어
  - ROLLBACK과 함께 사용하면 해당 지점까지 되돌릴 수 있다.

<br/><br/>

### ☑️ 트랜잭션이 수행되는 단계

![transaction flow](https://akasai.space/static/f1a4ec04c92b0531d8e40b5cb4bb8758/01e7c/transaction-flow.png) <br/>
출처: [트랜잭션의 상태](https://akasai.space/db/about_acid/)

<br/>

- 활성화 <br/>
: 트랜잭션이 시작되어 처리 중인 상태

- 부분적 완료 <br/>
: 트랜잭션의 마지막 연산까지 처리가 완료되었지만 데이터베이스에 트랜잭션 수행 결과가 반영되지 않은 상태

- 완료 <br/>
: 트랜잭션의 연산 처리가 완료되고 데이터베이스에 결과가 반영된 상태

- 실패 <br/>
: 트랜잭션 처리 중 오류가 발생해 트랜잭션이 중단된 상태

- 철회 <br/>
: 트랜잭션이 중단되어 ROLLBACK을 수행해 데이터베이스를 이전으로 되돌린 상태

<br/><br/>

### ☑️ 트랜잭션 격리(transaction isolation)
: 여러 트랜잭션이 서로 영향을 미치지 않고 실행될 수 있는 단계
- 한 트랜잭션이 다른 트랜잭션 작업의 조회 가능 여부를 결정한다. 

<br/>

#### ⏩ 트랜잭션 격리 수준(transaction isolation level)
- 동시성이 높아지면 여러 트랜잭션이 동시에 처리되고 데이터의 일관성에 문제가 발생할 확률도 높아진다. <br/>
반면, 고립성을 높이면 하나의 트랜잭션이 처리 중일 때 다른 트랜잭션의 접근이 제한되어 효율이 낮아진다. <br/>
➡︎ 그러므로 상황에 따라 데이터의 일관성을 유지하면서 트랜잭션을 효율적으로 처리할 수 있어야 한다.

<br/>

- Read Uncommited (읽기 미확정) <br/>
: 트랜잭션의 COMMIT 여부와 상관없이 다른 트랜잭션이 데이터를 조회할 수 있다. 
  - 한 번에 여러 트랜잭션을 처리할 수 있는 동시성은 높지만, 데이터의 일관성을 유지하기 어렵다.

- Read Commited (읽기 확정) <br/>
: 트랜잭션이 COMMIT된 데이터만 다른 트랜잭션이 조회할 수 있다.

- Repeatable Read (반복 읽기) <br/>
: 트랜잭션이 읽은 데이터를 다른 트랜잭션이 갱신하거나 삭제할 수 없다.

- Serializable (직렬화 가능) <br/>
: 트랜잭션이 읽은 데이터를 다른 트랜잭션이 갱신, 삭제, 삽입할 수 없다.

<br/>

![](https://velog.velcdn.com/images%2Fyu-jin-song%2Fpost%2F21b268bf-c691-48bc-b2ff-5a606baf84e3%2F%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98_%EA%B2%A9%EB%A6%AC%EC%88%98%EC%A4%80.png) <br/>
출처: [트랜잭션 격리 수준](https://velog.io/@yu-jin-song/DB-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%A9%EB%A6%AC-%EC%88%98%EC%A4%80Transaction-Isolation-Level)

<br/><br/>
<br/>
  
## ✅ 락 (lock)
: 트랜잭션이 처리되는 순서를 보장하기 위한 방법
- 운영체제에서 데이터 동기화를 위해 임계 영역에 대한 접근을 제한하는 상호배제 기법과 유사하다. 

<br/>

#### ⏩ 락(lock) 종류
- 공유 락(shared lock)
: 데이터를 읽는 락
  - 읽기 락(read lock)이라고도 한다. 
  - 데이터를 읽는 연산이므로 데이터의 일관성에 영향을 주지 않아 데이터에 여러 공유 락이 동시에 접근할 수 있다.

- 베타 락(exclusive lock)
: 데이터를 수정하는 락
  - 쓰기 락(write lock)이라고도 한다.
  - 데이터의 일관성을 유지하기 위해 데이터에 하나의 베타 락이 접근 중일 때 다른 베타 락이 접근할 수 없다.

<br/><br/>

### ☑️ 트랜잭션의 교착 상태
- 데이터베이스의 트랜잭션도 프로세스처럼 교착 상태(deadlock)에 빠질 수 있다. <br/>
이는 한 트랜잭션이 자신이 처리 중인 데이터에 대해 락을 가진 상태에서 다른 트랜잭션이 처리 중인 데이터에 대해 락을 요청해 무한 대기 상태에 빠진 현상을 의미한다. <br/>
➡︎ 즉, 특정 데이터의 락을 가지고 있는 트랜잭션이 다른 데이터의 락을 추가로 요청하며 발생한다.

<br/>

#### ⏩ 트랜잭션의 교착 상태 해결 방법
1. 예방 기법 <br/>
: 트랜잭션 처리가 시작되기 전에 필요한 데이터에 대해 미리 락을 얻는 방식

2. 회피 기법 <br/>
: 트랜잭션이 들어온 순서에 따라 교착 상태를 회피하는 방식
   - wait-die <br/>
: 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 갖고 있는 트랜잭션보다 오래되었다면, 락을 얻을 때까지 기다린다.
     - 반면, 락을 갖고 있는 트랜잭션보다 최신이라면, 락 획득을 포기한다.
   - wound-wait <br/>
: 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 갖고 있는 트랜잭션보다 오래되었다면, 락을 빼앗는다.
     - 반면, 락을 갖고 있는 트랜잭션보다 최신이라면, 락 획득을 기다린다.

<br/><br/>
<br/>

## ✅ 이상(anomaly)
: 트랜잭션을 처리하는 중에 속성 간 종속이나 데이터 중복으로 발생하는 문제

<br/>

#### ⏩ 이상(anomaly) 종류
- 삽입 이상(insertion anomaly) <br/>
: 데이터 삽입 시 의도치 않은 다른 데이터도 삽입된다.

- 갱신 이상(update anomaly) <br/>
: 데이터 갱신 시 일부 튜플만 갱신되어 데이터 모순이 발생한다.

- 삭제 이상(deletion anomaly) <br/>
: 데이터 삭제 시 의도하지 않은 데이터도 삭제된다.

<br/><br/>
<br/>

## ✅ 정규화 (normalization)
: 데이터베이스의 이상 현상을 해결하기 위해 테이블을 분해하는 것

- 단점 
  - 테이블을 분해하느라 연산 시간이 증가한다. <br/>
➡︎ 테이블을 상황에 따라 적절하게 정규화를 진행해야 이상 현상을 해결하고 연산 속도를 보장할 수 있다.


- 정규형(normal form) <br/>
: 정규화한 결과
  - 테이블을 분해하는 정도에 따라서 단계를 나눌 수 있다.

<br/>

### ☑️제1정규형



<br/>

### ☑️제2정규형



<br/>

### ☑️제3정규형



<br/>

### ☑️보이스-코드 정규형





<br/><br/>

### ☑️ 제4정규형과 제5정규형

1. 제4정규형

2. 제5정규형(5NF)

<br/>

#### ⏩ 역정규화 (denormalization)
: 정규화된 테이블을 낮은 정규화 단계의 테이블로 되돌리는 것
- 읽기 성능을 향상시킬 때 사용한다. 
- 정규화를 수행하면 테이블이 분해되므로 필요한 결과 데이터를 얻기 위해 조인 연산을 여러 번 수행해야 한다. <br/>
➡︎ 이 때문에 데이터베이스를 빈번히 조회하는 경우 성능 저하가 생길 수 있다. <br/>
👉 그래서 오히려 중복을 허용하는 역정규화를 수행한다. 

<br/><br/>
